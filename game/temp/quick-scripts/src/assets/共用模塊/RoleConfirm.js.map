{"version":3,"sources":["assets\\共用模塊\\RoleConfirm.js"],"names":["gameModel","require","cc","Class","Component","properties","WrongAlert","type","Node","AlertText","Label","onLoad","GameName","director","getScene","_name","substr","length","local_ID","window","location","host","Domain","CheckRole","GameStatusMessage","Game_Information","start","RoleComfirm","JudgeError","CannotJoinGame","JudgeRole","string","active","role","WebSocket_NumberOfPeople_Guest","WebSocket_GameStatus_Guest","game_type","loadScene","BackGround_Theme","GameStatusWS_Host","WebSocket","activity_id","game_id","scheduleOnce","WebSocket_NumberOfPeople_Host","WebSocket_GameStatus_Host","NumberOfLotteryWS_Host","update","dt"],"mappings":"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","sourceRoot":"/","sourcesContent":["var gameModel = require(\"Model\");\r\n\r\n///判斷腳色js\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        WrongAlert:{\r\n            default:null,\r\n            type:cc.Node\r\n        },\r\n        AlertText :{\r\n            default:null,\r\n            type:cc.Label\r\n        },\r\n    },\r\n    \r\n    onLoad () {\r\n        gameModel.GameName =  cc.director.getScene()._name.substr(12,cc.director.getScene()._name.length) //取得遊戲名稱\r\n        gameModel.local_ID = window.location.host == (\"hilives.net\" || \"www.hilives.net\") ? \"api.hilives.net\" : \"apidev.hilives.net\"\r\n        gameModel.Domain = \"https://\" + window.location.host; //取得目前的網域\r\n        this.CheckRole = false;\r\n        gameModel.GameStatusMessage = \"open\"\r\n        gameModel.Game_Information();\r\n    },\r\n\r\n    start() {\r\n        gameModel.RoleComfirm();\r\n    },\r\n\r\n    JudgeError(){\r\n        if (gameModel.CheckRole == true && gameModel.CannotJoinGame == \"\") this.JudgeRole();\r\n        else if(gameModel.CheckRole == true && gameModel.CannotJoinGame != \"\")\r\n        {\r\n            this.AlertText.string = gameModel.CannotJoinGame;\r\n            this.WrongAlert.active = true;\r\n            gameModel.CheckRole = false\r\n        }\r\n    },\r\n\r\n    //判斷用戶角色並切換至各自角色場景\r\n    JudgeRole(){\r\n       gameModel.CheckRole = false\r\n       if(gameModel.role == \"guest\" && this.CheckRole == false) \r\n       {\r\n          this.CheckRole = true;\r\n          gameModel.WebSocket_NumberOfPeople_Guest(1000,false)\r\n          gameModel.WebSocket_GameStatus_Guest();\r\n          if(gameModel.game_type == \"turntable\") cc.director.loadScene(\"Guest1_Weel\"+ gameModel.BackGround_Theme);\r\n          else if (gameModel.game_type == \"jiugongge\") cc.director.loadScene(\"Guest1_Jiugongge\"+ gameModel.BackGround_Theme);\r\n          else cc.director.loadScene(\"Guest1_JoinGame\"+ gameModel.BackGround_Theme);\r\n       }\r\n       else if(gameModel.role == \"host\" && this.CheckRole == false) \r\n       {\r\n            this.CheckRole = true;\r\n            gameModel.GameStatusWS_Host = new WebSocket(\"wss://\" + gameModel.local_ID + \"/ws/v1/game/status/host?activity_id=\"+ gameModel.activity_id +'&game_id=' + gameModel.game_id + '&game='+ gameModel.GameName); //開啟遊戲狀態ws\r\n            this.scheduleOnce(function() {   //每1秒鐘值行一次，重複做1次\r\n                gameModel.WebSocket_NumberOfPeople_Host();\r\n                if(gameModel.game_type == \"turntable\")  \r\n                {\r\n                    gameModel.WebSocket_GameStatus_Host(\"close\",0.1)\r\n                    gameModel.NumberOfLotteryWS_Host = new WebSocket(\"wss://\" + gameModel.local_ID + \"/ws/v1/game/winning/staff?activity_id=\"+ gameModel.activity_id +'&game_id=' + gameModel.game_id + '&game='+ gameModel.GameName); //開啟更新得獎人的ws\r\n                    cc.director.loadScene(\"Host1_Weel\"+ gameModel.BackGround_Theme);\r\n                }\r\n                else if (gameModel.game_type == \"jiugongge\") \r\n                {\r\n                    gameModel.WebSocket_GameStatus_Host(\"close\",0.1)\r\n                    gameModel.NumberOfLotteryWS_Host = new WebSocket(\"wss://\" + gameModel.local_ID + \"/ws/v1/game/winning/staff?activity_id=\"+ gameModel.activity_id +'&game_id=' + gameModel.game_id + '&game='+ gameModel.GameName); //開啟更新得獎人的ws\r\n                    cc.director.loadScene(\"Host1_Jiugongge\"+ gameModel.BackGround_Theme);\r\n                }\r\n                else \r\n                {\r\n                    gameModel.WebSocket_GameStatus_Host(\"open\",0.1)\r\n                    cc.director.loadScene(\"Host1_Start\"+ gameModel.BackGround_Theme);\r\n                }\r\n             }, 1);\r\n       }\r\n    },\r\n   \r\n     //持續判斷用戶角色\r\n     update(dt) {\r\n         this.JudgeError();\r\n     },\r\n});\r\n"]}
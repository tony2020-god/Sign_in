{"version":3,"sources":["assets\\共用模塊\\Guest1_ConfirmDeviceMotionEvent.js"],"names":["gameModel","require","cc","Class","Component","properties","WrongAlert","type","Node","onLoad","join","AlertText","find","TopTitle","getComponent","Sprite","spriteFrame","Prize_BackGround","Guest1_Join_JS","start","systemEvent","setAccelerometerEnabled","on","SystemEvent","EventType","DEVICEMOTION","onDeviceMotionEvent","HostWindow","Label","string","active","event","x","acc","toFixed","y","z","speed","parseFloat","sys","os","GameStatusMessage","CannotJoinGame","WebSocket_NumberOfPeople_Guest","JoinGame","DeviceOrientationEvent","requestPermission","then","permissionState","err","console","log","ConnetSuccess","director","loadScene","BackGround_Theme","ConnetFail","CloseAlert"],"mappings":"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","sourceRoot":"/","sourcesContent":["var gameModel = require(\"Model\");\r\n\r\n///確認玩家是否為陀螺儀和加入遊戲js\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n       WrongAlert:{\r\n          default:null,\r\n          type:cc.Node\r\n       },\r\n    },\r\n\r\n      onLoad () {\r\n        this.join = false; //是否按下加入遊戲按鈕\r\n        this.AlertText = cc.find(\"畫布/警告/警告文字\")\r\n        gameModel.TopTitle = cc.find(\"畫布/場景/標題\").getComponent(cc.Sprite).spriteFrame\r\n        gameModel.Prize_BackGround = cc.find(\"畫布/場景/背景\").getComponent(cc.Sprite).spriteFrame\r\n        gameModel.Guest1_Join_JS = this;\r\n      },\r\n      \r\n      start () {\r\n        //啟動陀螺儀\r\n        cc.systemEvent.setAccelerometerEnabled(true);\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.DEVICEMOTION, this.onDeviceMotionEvent, this);\r\n        if(gameModel.HostWindow == \"close\")\r\n       {\r\n        this.AlertText.getComponent(cc.Label).string = \"主辦單位已關閉視窗，遊戲中止\"\r\n        this.WrongAlert.active = true\r\n       }\r\n      },\r\n\r\n      onDeviceMotionEvent :function (event){\r\n        var x = event.acc.x.toFixed(2); \r\n        var y = event.acc.y.toFixed(2); \r\n        var z = event.acc.z.toFixed(2); \r\n        var speed = parseFloat(x)+parseFloat(y)+parseFloat(z);\r\n        if(speed == 0.00 && cc.sys.os == \"Android\" && this.join == true && gameModel.GameStatusMessage != \"close\" && gameModel.CannotJoinGame != \"錯誤: 該場次遊戲不允許重複中獎，您已中獎，無法參加下一輪遊戲\")       //如果是安卓，且沒陀螺儀功能則跳出 \"此設備不支援搖一搖功能!\" 的警告\r\n        {\r\n          this.AlertText.getComponent(cc.Label).string = \"此設備不支援搖一搖功能\";\r\n          this.WrongAlert.active = true\r\n          cc.systemEvent.setAccelerometerEnabled(false);\r\n        }\r\n        else if(speed != 0.00 && cc.sys.os == \"Android\" && this.join == true && gameModel.GameStatusMessage != \"close\") //如果是安卓，且有陀螺儀功能則啟動WebSocket_NumberOfPeople_Guest傳送玩家cookie給後端，並進入玩家等待遊戲開始畫面\r\n        {\r\n          this.join = false\r\n          gameModel.WebSocket_NumberOfPeople_Guest(500,true);\r\n        }\r\n        else if (gameModel.GameStatusMessage == \"close\" && gameModel.CannotJoinGame != \"錯誤: 該場次遊戲不允許重複中獎，您已中獎，無法參加下一輪遊戲\" && this.join == true)\r\n        {\r\n          this.join = false\r\n          this.AlertText.getComponent(cc.Label).string = \"請等待主辦方連接後再加入遊戲\";\r\n          this.WrongAlert.active = true\r\n        }\r\n    },\r\n\r\n    //加入遊戲鍵: 要求Iphone客戶打開陀螺儀，判斷Android客戶是否有陀螺儀\r\n    JoinGame(){\r\n      this.join = true;\r\n      if (cc.sys.os == \"iOS\"&& this.join == true && gameModel.GameStatusMessage != \"close\") \r\n      {\r\n          if (typeof DeviceOrientationEvent.requestPermission === 'function') {\r\n            DeviceOrientationEvent.requestPermission()\r\n                .then(permissionState => {\r\n                  if (permissionState === 'granted') {\r\n                    gameModel.WebSocket_NumberOfPeople_Guest(500,true);\r\n                    this.join = false;\r\n                  } else {\r\n                     //取消\r\n                  }\r\n                })\r\n                .catch((err) => {\r\n                    console.log(err)\r\n                });\r\n            } else {\r\n            }\r\n      }\r\n      else if (gameModel.GameStatusMessage == \"close\" && gameModel.CannotJoinGame != \"錯誤: 該場次遊戲不允許重複中獎，您已中獎，無法參加下一輪遊戲\" && this.join == true)\r\n      {\r\n        this.join = false;\r\n        this.AlertText.getComponent(cc.Label).string = \"請等待主辦方連接後再加入遊戲\";\r\n        this.WrongAlert.active = true\r\n      }\r\n    },\r\n\r\n    ConnetSuccess(){\r\n      if(gameModel.CannotJoinGame == \"\") cc.director.loadScene(\"Guest2_Wait\"+ gameModel.BackGround_Theme);\r\n      else\r\n      {\r\n        this.AlertText.getComponent(cc.Label).string = gameModel.CannotJoinGame;\r\n        this.WrongAlert.active = true\r\n      }\r\n    },\r\n\r\n    ConnetFail(){\r\n      this.AlertText.getComponent(cc.Label).string = \"無法連接伺服器\"\r\n      this.WrongAlert.active = true\r\n    },\r\n\r\n    CloseAlert(){\r\n      this.WrongAlert.active = false;\r\n      if(gameModel.CannotJoinGame == \"錯誤: 該場次遊戲不允許重複中獎，您已中獎，無法參加下一輪遊戲\" && gameModel.HostWindow != \"close\") cc.director.loadScene(\"Guest5_Prize\"+ gameModel.BackGround_Theme);\r\n      else gameModel.HostWindow = \"open\"\r\n    }\r\n    // update (dt) {},\r\n});\r\n"]}